%----------------------------------------------------------------------------
\chapter{Szórásanalízis aka ANOVA}

A célünk kideríteni, hogy van-e hatása a független változóknak a függő változóra illetve, hogy ez a hatás egyforma vagy különböző. A hatás, kapcsolat függvényszerű feltárása akkor sem cél, ha a független változók kvantitatívek. A szórásanalízis megelőzi a regressziós vizsgálatokat, megadja, hogy van-e értelme keresni az összefüggés jellegét. Alapfogalmak:
\begin{itemize}
\item \emph{Faktor:} a vizsgálatba bevont változók
\begin{itemize}
\item Kvantitatív faktor: numerikus vagy intervallum skálájú
\item Kvalitatív faktor: nem kvantitatív
\end{itemize}
\item \emph{Faktor szint:} a faktor értékkészletének egy eleme, ezen beállítások mellett figyeljük meg a függő változót
\begin{itemize}
\item Véletlen faktor: nem tudjuk előre garantálni, hogy milyen értéket vesz fel
\item Beállított faktor: a felvett értékeket előre be tudjuk állítani
\end{itemize}
\item \emph{Interakció:} az egyes faktorok között feltételezett kapcsolat
\item \emph{Kezelés:} egyfaktoros esetben a faktor szintje, többfaktoros esetben a figyelembe vett faktorok szintjeiből előálló kombinációk
\end{itemize}

A modelleket a faktorok száma szerint csoportosítjuk, így beszélhetünk egy-, két-, háromfaktoros modellekről stb. Bizonyos kérdéseket csak többfaktorok modellekben tehetünk fel (pl. interakció kérdése).

\section{Fisher-Cohran tételek}

\emph{Addíciós tétel:} Ha $Q_1, Q_2, …, Q_k$ teljesen független rendre $n_1, n_2, …, n_k$ szabadságfokú $a>0$ paraméterű $\chi^2$-eloszlású változók, akkor a $Q= Q_1+ Q_2+ …+ Q_k$ szintén $\chi^2$-eloszlású lesz $n= n_1+ n_2+ …+n_k$ szabadságfokkal és $a>0$ paraméterrel.

\emph{Partíciós tétel:} Legyenek $X_1, X_2,...,X_n$ teljesen független, $0$ várható értékű és $a$ varianciájú normális eloszlású változók, $Q_j=X^T\mathbf{\underline{A}}_jX  (j=1,2,…, k)$ kvadratikus alakok, ahol $rank(A_i)=n_i$. Tegyük fel, hogy $n= n_1+ n_2+ …+n_k$ és $Q_1+ Q_2+ …+ Q_k = X_1^2+X_2^2+ …+X_n^2$. Akkor a $Q_1, Q_2, …, Q_k$ kifejezések rendre $n_1, n_2, …, n_k$ szabadságfokú, $a>0$ paraméterű, teljesen független $\chi^2$-eloszlású változók.

\section{Kísérleti elrendezések}

\emph{Hierarchikus osztályozás:} a faktorok hierarchiában vannak és egy faktor összes szintje a felette álló faktor egy szintjéhez kapcsolódik. Ilyen kísérleti beállítást követünk, amikor $p$ osztály tanulóinak tudását akarjuk összehasonlítani, $r$ különböző tantárgy számonkérésével.

\emph{Keresztosztályozás:} Az $A$ és $B$ faktor szintjeinek minden párosításához veszünk egy- vagy többelemű mintát. Kettőnél több faktor esetén azon kezelés kombinációhoz veszünk mintát, ahol $k$ a faktorok száma.

\emph{Nem teljes kísérleti elrendezések:} olyankor alkalmazandó, amikor egy vizsgálandó faktor mellett más, nem kívánt, de számontartott hatás is fellép és azokat ki akarjuk küszöbölni, pl. a latin négyzetek módszerével. Tegyük fel, hogy a célváltozónkkal három kategóriaváltozó van kapcsolatban, mindegyik $r>1$ szinttel:
\begin{itemize}
\item \emph{Véletlen blokkok módszere:} $C$ faktor hatását úgy elimináljuk, hogy a $B$ faktor minden szintjéhez az $A$ faktor szintjeinek egy véletlen permutációját rendeljük. Ilyenkor $r^3$ kezelésre van szükség
\item \emph{Latin négyzete módszere:} $r^2$ kezelés is elég a döntéshez az alábbi szisztéma szerint:

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|l|l|}
\hline
 & $A_1$ & $A_2$ & $...$ & $A_p$
\\ \hline
$B_1$ & $C_{11}$ & $C_{12}$ & $...$ & $C_{1p}$
\\ \hline
$B_2$ & $C_{21}$ & $C_{22}$ & $...$ & $C_{2p}$
\\ \hline
... & ...& ...&...& ...
\\ \hline
$B_r$ & $C_{r1}$ & $C_{r2}$ & $...$ & $C_{rp}$
\\ \hline
\end{tabular}
\end{table}

A módszer feltételezi, hogy a faktorok közötti interakciók nem jelentősek. Alkalmazásának feltételei:
\begin{enumerate}
\item Minden kezeléshez tartozó mintának követnie kell a normális eloszlást
\item Minták szórásnégyzeteinek meg kell egyezniük
\item Mintáknak függetleneknek kell lenniük
\end{enumerate}

Tekintsünk egy $H=(h_{ij})$ $r$x$r$-es latin négyzetet (mátrix, aminek minden sora és oszlopa $1,...,r$ véletlen permutációja)! A három faktor minden $(i, j, h_{ij})$ szintbeállítása mellett figyeljük meg a célváltozó értékét ($X_{ijh}$)! Feltesszük, hogy a $X_{ijh}$ változók teljesen független normális eloszlásúak és $\mathbf{E}X_{ijh}=f_h+b_i+c_j$, $\mathbf{\sigma}X_{ijh}=\sigma$, vagyis célváltozó várható értékére mindhárom faktor additív taggal van hatással.

$H_0$: a harmadik faktor szintjei nincsenek hatással a célváltozóra, vagy $f_j$ mindenhol azonos.

A döntéshez a faktorok szintjeihez tartozó átlagok és a minta teljes átlagának négyzetes eltéréseit kell vizsgálni, valamit ki kell számolni a véletlen ingadozásokat kifejező négyzetes eltérést is. Amennyiben igaz a nullhipotézis, akkor a \\$\frac{\text{harmadik faktorhoz tartozó eltérések négyzetösszege}}{\text{véletlen ingadozásokat kifejező négyzetes eltérés}}(r-2)$ próbastatisztika \\$F_{(r-1),(r-1)(r-2)}$-eloszlást követ.

\end{itemize}

\pagebreak

\section{Egyszeres osztályozás}

Egy $X$ normális eloszlású változónak egyetlen $L$ szintű faktorváltozóval való kapcsolatát vizsgáljuk (one-way-ANOVA). Az $X$-re vett $n$ elemű mintát a faktor szintjei szerint $L$ csoportba soroljuk.

$H_0$: az $L$ db minta átlagai között nincs különbség

Amennyiben igaz a nullhipotézis, akkor a $\frac{\frac{\Sigma^L_{i=1}n_i \big(\bar{x}^{(i)} - \bar{x} \big)^2}{L-1}}{\frac{\Sigma^L_{i=1}n_i \big (x^{(i)}_j - \bar{x}^{(i)} \big)^2}{n-L}}$ statisztika\\ $F_{(L-1),(n-L)}$-eloszlású lesz. Ha a nullhipotézist el kell vetni, akkor az eltérések nagyságát Student próbával lehet megbecsülni.

\section{Kétszeres osztályozás}

Ha egy folytonos függőváltozó, és két nominális faktorváltozó adott, kétszeres osztályozásról beszélünk. Tegyük fel hogy az egyik faktor értékei az $1, 2, ..., L$ a másik faktor értékei az $1, 2, ..., K$ közül valók. Így a mintát összesen $K$x$L$ részhalmazra bonthatjuk. Feltesszük, hogy a minták normális eloszlásúak és a szórásaik ismeretlenek, de azonos értékűek.

Ha a két nominális faktorváltozó között nincs interakció, akkor feltesszük a $(j,k)$ cella elméleti várhatóértéke $\mu_{j,k} = a_j+g_k$ alakú, ahol az első tag az első faktor $j$ szintjéből, a második tag pedig a második faktor $k$ szintjéből eredő tag.

$H_0$: Az első faktor szintjeihez ugyanakkora hatás tartozik minden cellában

Amennyiben igaz a nullhipotézis, akkor a
$\frac{\frac{L \cdot \Sigma^L_{i=1}n_i \big(\bar{x}_i - \bar{x} \big)^2}{L-1}}{\frac{\text{véletlen ingadozásokat mérő négyzetösszeg}}{(L-1)(K-1)}}$
statisztika\\ $F_{(L-1),(L-1)(K-1)}$ eloszlást követ. Vagyis, ha a nullhipotézist elfogadjuk, akkor az első faktornak nincsen hatása a célváltozóra.

Ezzel az eljárással a második faktor hatását is tesztelhetjük, csak akkor a próbastatisztikában a felsző tört számlálójába $K \cdot \Sigma^K_{j=1}n_i \big(\bar{x}_j - \bar{x} \big)^2$ (a második faktor magyarázta négyzetösszeg) kerül.

Ha interakciót is feltételezünk a faktorok között, akkor a $(j,k)$ cella elméleti várhatóértéke $\mu_{j,k} = \mu + a_j+g_k + c_{i,j}$ alakú, ahol $c_{i,j}$ fejezi ki, hogy a hatások erősítik vagy gyengítik egymást. A módszer alkalmas egyidejűleg három hipotézis ellenőrzésére is:
\begin{enumerate}
\item Az első faktornak minden cellában ugyanakkora a hatása
\item A második faktornak minden cellában ugyanakkor a hatása
\item $c_{i,j}=0$ minden cellában
\end{enumerate}

A nullhipotézisek ellenőrzéséhez itt is az átlagtól való eltérés négyzetösszegeit kell számolunk: az első és második faktor magyarázta eltérések négyzetösszegei, az interakcióval magyarázott eltérés négyzetösszege és a csoportokon belüli ingadozásokat mérő véletlen hibatag. A próbastatisztikáknak igaz nullhipotézisek esetén $F$-eloszlást kell követnie.
